<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brew Log | Coffee Lab</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&family=Inter:wght@300;400;700&display=swap"
        rel="stylesheet">
</head>

<body>

    <nav>
        <a href="index.html" class="nav-link matrix-effect">Home</a>
        <a href="brew.html" class="nav-link active matrix-effect">Brew</a>
        <a href="drinks.html" class="nav-link matrix-effect">Drinks</a>
    </nav>

    <div class="content-wrapper">
        <main class="container">
            <h1 class="matrix-effect" style="text-align: center;">New Extraction</h1>

            <div class="glass-panel" style="max-width: 800px; margin: 0 auto;">
                <form id="brew-form">

                    <!-- Grinder Section -->
                    <div class="form-section">
                        <h2 class="matrix-effect">Grinder (DF64V)</h2>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div>
                                <label>Grind Size</label>
                                <input type="number" step="0.1" name="grindSize" class="glass-input"
                                    placeholder="e.g. 15.5" required>
                            </div>
                            <div>
                                <label>RPM</label>
                                <input type="number" name="rpm" class="glass-input" placeholder="e.g. 1000">
                            </div>
                        </div>
                    </div>

                    <!-- Dose Section -->
                    <div class="form-section">
                        <h2 class="matrix-effect">Dose</h2>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div>
                                <label>Dose (g)</label>
                                <input type="number" step="0.1" name="dose" id="dose-input" class="glass-input"
                                    placeholder="18.0" required>
                            </div>
                            <div>
                                <label>Ratio (1:x)</label>
                                <input type="number" step="0.1" name="ratio" id="ratio-input" class="glass-input"
                                    placeholder="2.0">
                            </div>
                        </div>
                        <div id="yield-calc"
                            style="text-align: right; color: var(--md-sys-color-primary); font-size: 0.9rem; margin-bottom: 1rem; margin-top: 0.5rem; font-weight: bold;">
                            Target Yield: -- g</div>
                    </div>

                    <!-- Brew Phase -->
                    <div class="form-section">
                        <h2 class="matrix-effect">Brew Profile</h2>

                        <!-- Preinfusion -->
                        <div style="margin-bottom: 1rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="preinfusion-check"
                                    style="width: auto; margin-right: 0.5rem;"> Enable Pre-infusion
                            </label>
                            <div id="preinfusion-fields"
                                style="display: none; padding-left: 1rem; border-left: 3px solid var(--md-sys-color-secondary); margin-top: 0.5rem;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div>
                                        <label>Pressure (Bar)</label>
                                        <input type="number" step="0.1" name="preinfusionBar" class="glass-input">
                                    </div>
                                    <div>
                                        <label>Until Weight (g)</label>
                                        <input type="number" step="0.1" name="preinfusionWeight" class="glass-input">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Peak -->
                        <div style="margin-bottom: 1rem;">
                            <label style="margin-bottom: 0.5rem; display: block;">Peak Extraction</label>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div>
                                    <label>Pressure (Bar)</label>
                                    <input type="number" step="0.1" name="peakBar" class="glass-input" required>
                                </div>
                                <div>
                                    <label>Until Weight (g)</label>
                                    <input type="number" step="0.1" name="peakWeight" class="glass-input" required>
                                </div>
                            </div>
                        </div>

                        <!-- Tapering -->
                        <div>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="tapering-check" style="width: auto; margin-right: 0.5rem;">
                                Enable Tapering
                            </label>
                            <div id="tapering-fields"
                                style="display: none; padding-left: 1rem; border-left: 3px solid var(--md-sys-color-secondary); margin-top: 0.5rem;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div>
                                        <label>End Pressure (Bar)</label>
                                        <input type="number" step="0.1" name="taperingBar" class="glass-input">
                                    </div>
                                    <div>
                                        <label>Final Weight (g)</label>
                                        <input type="number" step="0.1" name="taperingWeight" class="glass-input">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 2rem; display: flex; gap: 1rem; align-items: center;">
                        <button type="submit" class="glass-btn" style="flex: 2;">Save Brew</button>
                        <button type="button" id="download-json" class="glass-btn"
                            style="background-color: var(--md-sys-color-secondary-container); color: var(--md-sys-color-on-secondary-container); flex: 1; font-size: 0.9rem;">Download
                            JSON</button>
                    </div>

                </form>
            </div>
        </main>
    </div>

    <script src="js/matrix.js"></script>
    <script src="js/main.js"></script>
    <script src="js/recipes.js"></script>
    <script>
        // Inline UI logic for conditional fields
        document.getElementById('preinfusion-check').addEventListener('change', (e) => {
            document.getElementById('preinfusion-fields').style.display = e.target.checked ? 'block' : 'none';
        });
        document.getElementById('tapering-check').addEventListener('change', (e) => {
            document.getElementById('tapering-fields').style.display = e.target.checked ? 'block' : 'none';
        });

        // Yield Calc
        const dose = document.getElementById('dose-input');
        const ratio = document.getElementById('ratio-input');
        const yieldDisplay = document.getElementById('yield-calc');

        function updateYield() {
            if (dose.value && ratio.value) {
                yieldDisplay.innerText = `Target Yield: ${(dose.value * ratio.value).toFixed(1)} g`;
            } else {
                yieldDisplay.innerText = "Target Yield: -- g";
            }
        }
        dose.addEventListener('input', updateYield);
        ratio.addEventListener('input', updateYield);
    </script>
</body>

</html>